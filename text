<!DOCTYPE html>
<html>
<head>
    <title>AdminCamara</title>
</head>
<body>
    <script>
        var camaras = [];
        function getCamaras(){
            fetch('http://localhost:8080/api/v1/camaras')
            .then(response => response.json())
            .then(data => {
                let table = '<table><tr><th>Nombre</th><th>Url</th><th>Ubicacion</th><th>Threshold</th></tr>';
                data.forEach(camara => {
                    console.log(camara);
                    camaras.push(camara);
                    table += '<tr><td>' + camara.name + '</td><td>' + camara.url + '</td><td>' + camara.location + '</td><td>'+ camara.threshold+ '</td><td> <button onclick=deleteCamara(' + '"'+ camara.name.replace(/\s+/g, '') + '"' + ')>Eliminar</button> </td></tr>';
                });
                table += '</table>';
                document.body.innerHTML += table;
            });
        }
        function addCamara(){
            let name = document.getElementById('name').value;
            let location = document.getElementById('location').value;
            let url = document.getElementById('url').value;
            let threshold = document.getElementById('threshold').value;
            console.log(name, location, url, threshold);
            fetch('http://localhost:8080/api/v1/camara', {
                method: 'POST',
                headers: {
                    "Accept": "*/*"
                },
                body: JSON.stringify({name: name, location: location, url: url, threshold: threshold}),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                window.location.reload();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
        function deleteCamara(name) {
            var id = 0;
            console.log(camaras)
            for (let i = 0; i < camaras.length; i++) {
                aux = camaras[i].name.replace(/\s+/g, '');
                if (aux == name) {
                    id = camaras[i].Id;
                    break;
                }
            }
            console.log("Borrar camara: "+ name+", "+id)
            fetch('http://localhost:8080/api/v1/camaras/' + id, {
                method: 'DELETE',
                headers: {
                    "Accept": "*/*"
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                window.location.reload();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
        getCamaras();
    </script>
    <style>
    th, td {border: 1px solid black;}
    </style>
    <h1>
        Camaras
    </h1> 
    <div> 
        <label for="name">Nombre:</label> 
        <input type="text" id="name" name="name" required> 
        <label for="url">URL:</label> 
        <input type="text" id="url" name="url" required> 
        <label for="location">Ubicacion:</label> 
        <input type="text" id="location" name="location" required> 
        <label for="threshold">Threshold:</label> 
        <input type="text" id="threshold" name="threshold" required> 
        <button onclick="addCamara()">Agregar</button> 
    </div>
    <br>
</body>
</html>